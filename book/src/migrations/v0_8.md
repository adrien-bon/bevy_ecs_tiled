# Migration to `bevy_ecs_tiled` v0.8

This guide outlines the steps required to migrate your project to version `0.8` of `bevy_ecs_tiled`.

## Main Changes

- **Rationalize naming**: Several types or functions have been renamed to better reflect what they actually do.
- **Improved `Event` API**: Provides an unified way to handle events and access underlying Tiled data.
- **Simplify `TiledMapStorage` usage**: Add helpers functions to the `TiledMapStorage` component so it's easier to work with.
- **Explicit `SystemSet`**: Allow precise systems ordering for user applications.
- **Source code re-organization**: Several files have been moved around or renamed.
- **Attach shape information to `TiledObject`**: Direct access to Tiled objects shape information through ECS.

## Migration Steps

1. **Update the dependency in `Cargo.toml`**:

    ```toml
    bevy_ecs_tiled = "0.8"
    ```

2. **Adjust your types**:

    Some types have been renamed, without any functional change, or not much.

    It should be safe to simply run a "search and replace" command, in the following order (make sure to match whole words):

    | Old name | New name | Functional changes ? |
    |----------|----------|----------------------|
    | `TiledMap` | `TiledMapAsset` | |
    | `TiledWorld` | `TiledWorldAsset` | |
    | `TiledMapHandle` | `TiledMap` | |
    | `TiledWorldHandle` | `TiledWorld` | |
    | `TiledMapPlugin` | `TiledPlugin` | |
    | `TiledColliderSpawnInfos` | `TiledPhysicsBackendOutput` | |
    | `TiledMapMarker` | `TiledMap`| This one was actually removed |
    | `TiledWorldMarker` | `TiledWorld` | This one was actually removed |
    | `TiledMapLayer` | `TiledLayer` | `TiledLayer` now holds the layer kind |
    | `TiledMapTileLayer` | `TiledLayer` | `TiledLayer` now holds the layer kind |
    | `TiledMapObjectLayer` | `TiledLayer` | `TiledLayer` now holds the layer kind |
    | `TiledMapGroupLayer` | `TiledLayer` | `TiledLayer` now holds the layer kind |
    | `TiledMapImageLayer` | `TiledLayer` | `TiledLayer` now holds the layer kind |
    | `TiledMapTileLayerForTileset` | `TiledTilemap` | |
    | `TiledMapTile` | `TiledTile` | |
    | `TiledMapObject` | `TiledObject` | |
    | `TiledMapImage` | `TiledImage` | |

3. **Adjust your functions**:

    Some functions have been renamed, without changing their behaviour, or not much.

    It should be safe to simply run a "search and replace" command:

    | Old name | New name |
    |----------|----------|
    | `get_map_type` | `tilemap_type_from_map` |
    | `get_grid_size` | `grid_size_from_map` |
    | `get_tile_size` | `tile_size_from_map` |
    | `tile_size_from_grid` | `tile_size_from_grid_size` |

    The following functions are now methods of the `TiledMapAsset` struct:

    - `for_each_tile`
    - `world_space_from_tiled_position` (renamed from `from_tiled_position_to_world_space`)

4. **Adjust your imports**:

    Some modules or types have changed names or locations.
    If you import types using their defining path you may need to adjust.

    An easy way to get past this is to import the whole prelude: `bevy_ecs_tiled::prelude::*` or to use the type prelude path, such as `bevy_ecs_tiled::prelude::TiledPlugin`.

5. **Adjust `Event` API usage**

The event API has been reworked and now revolves around a generic [`TiledEvent<E>`](https://docs.rs/bevy_ecs_tiled/latest/bevy_ecs_tiled/tiled/event/struct.TiledEvent.html) structure.
This provides more context for each event, including the origin of each particular event `E` and helper methods to access Tiled data.

See the [dedicated guide on events](../design/map_events.md) for details.

6. **Adjust `TiledMapStorage` component usage**

Fields in [`TiledMapStorage`](https://docs.rs/bevy_ecs_tiled/latest/bevy_ecs_tiled/tiled/map/storage/struct.TiledMapStorage.html) are now private.
You should use the provided methods instead of accessing fields directly.

## Resources

- [Main documentation](../index.html)
- [API Reference](https://docs.rs/bevy_ecs_tiled/latest/bevy_ecs_tiled/)
- [Examples](https://github.com/adrien-bon/bevy_ecs_tiled/tree/main/examples/README.md)
- [Full CHANGELOG](https://github.com/adrien-bon/bevy_ecs_tiled/tree/main/CHANGELOG.md)
