<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Add physics colliders - bevy_ecs_tiled Documentation</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../FAQ.html">FAQ</a></li><li class="chapter-item expanded affix "><li class="part-title">Design and explanation</li><li class="chapter-item expanded "><a href="../design/why_tiled.html"><strong aria-hidden="true">1.</strong> Why using Tiled ?</a></li><li class="chapter-item expanded "><a href="../design/entities_hierarchy.html"><strong aria-hidden="true">2.</strong> Entities hierarchy and marker components</a></li><li class="chapter-item expanded "><a href="../design/z_order.html"><strong aria-hidden="true">3.</strong> Z-ordering</a></li><li class="chapter-item expanded "><a href="../design/map_events.html"><strong aria-hidden="true">4.</strong> Map loading events</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Coordinates conversion between Tiled and Bevy</div></li><li class="chapter-item expanded affix "><li class="part-title">How-To's</li><li class="chapter-item expanded "><a href="../guides/minimal.html"><strong aria-hidden="true">6.</strong> Minimal working example</a></li><li class="chapter-item expanded "><a href="../guides/spawn_reload.html"><strong aria-hidden="true">7.</strong> Spawn / Despawn / Reload a map</a></li><li class="chapter-item expanded "><a href="../guides/physics.html" class="active"><strong aria-hidden="true">8.</strong> Add physics colliders</a></li><li class="chapter-item expanded "><a href="../guides/properties.html"><strong aria-hidden="true">9.</strong> Use Tiled custom properties</a></li><li class="chapter-item expanded "><a href="../guides/debug.html"><strong aria-hidden="true">10.</strong> Debug your project</a></li><li class="chapter-item expanded affix "><li class="part-title">Migration guides</li><li class="chapter-item expanded "><a href="../migrations/v0_7.html"><strong aria-hidden="true">11.</strong> From v0.6.X to v0.7.X</a></li><li class="chapter-item expanded "><a href="../migrations/v0_6.html"><strong aria-hidden="true">12.</strong> From v0.5.X to v0.6.X</a></li><li class="chapter-item expanded "><a href="../migrations/v0_5.html"><strong aria-hidden="true">13.</strong> From v0.4.X to v0.5.X</a></li><li class="chapter-item expanded "><a href="../migrations/v0_4.html"><strong aria-hidden="true">14.</strong> From v0.3.X to v0.4.X</a></li><li class="chapter-item expanded affix "><li class="part-title">Miscellaneous</li><li class="chapter-item expanded "><a href="../misc/useful-links.html"><strong aria-hidden="true">15.</strong> Useful links</a></li><li class="chapter-item expanded "><a href="../misc/contributing.html"><strong aria-hidden="true">16.</strong> Contributing</a></li><li class="chapter-item expanded "><a href="../misc/api-reference.html"><strong aria-hidden="true">17.</strong> API reference</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">bevy_ecs_tiled Documentation</h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="add-physics-colliders"><a class="header" href="#add-physics-colliders">Add physics colliders</a></h1>
<p>Tiled allows you to add objects to your map: either directly on an object layer or attached to a tile.
<code>bevy_ecs_tiled</code> can use these objects to automatically spawn physics colliders when loading the map.</p>
<p>We provide two working physics backends: one using <a href="https://github.com/Jondolf/avian"><code>avian</code></a> and another one using <a href="https://github.com/dimforge/bevy_rapier"><code>rapier</code></a>.
They are very close in terms of features regarding <code>bevy_ecs_tiled</code> so feel free to choose the one you prefer.</p>
<p>The API allows you to either use these backends &quot;as-is&quot;, customize them or implement your own backend.</p>
<h2 id="create-collider-objects-in-tiled"><a class="header" href="#create-collider-objects-in-tiled">Create collider objects in Tiled</a></h2>
<p>First step is to have on your map something that we can actually use to spawn a collider :</p>
<ul>
<li>objects attached to an object layer: these are the regular objects you can place on the map when working on an object layer.</li>
<li>objects attached to a tile: for these, you will need to actually edit your tileset and use Tiled <a href="https://doc.mapeditor.org/en/stable/manual/editing-tilesets/#tile-collision-editor">builtin collision editor</a>.</li>
</ul>
<p>These two kinds of objects, eventhough they are handled a bit differently, will actually produce the same result: using the object associated shape we will spawn the corresponding physic collider.</p>
<h2 id="automatically-spawn-colliders"><a class="header" href="#automatically-spawn-colliders">Automatically spawn colliders</a></h2>
<p>In order to automatically spawn colliders from Tiled objects, you need two things:</p>
<ul>
<li>enable the proper feature: either <code>avian</code> or <code>rapier</code>, depending on your backend choice. You can eventually only enable the <code>physics</code> feature, but you'll have to provide your own physics backend.</li>
<li>instanciate the <a href="https://docs.rs/bevy_ecs_tiled/latest/bevy_ecs_tiled/physics/struct.TiledPhysicsPlugin.html"><code>TiledPhysicsPlugin</code></a> with the associated <a href="https://docs.rs/bevy_ecs_tiled/latest/bevy_ecs_tiled/physics/trait.TiledPhysicsBackend.html"><code>TiledPhysicsBackend</code></a> of your choice.</li>
</ul>
<p>For instance, to automatically add colliders using the <code>Avian</code> backend:</p>
<pre><pre class="playground"><code class="language-rust no_run">use bevy::prelude::*;
use bevy_ecs_tiled::prelude::*;

// You must enable the 'avian' feature from bevy_ecs_tiled

fn main() {
    App::new()
        // Load bevy_ecs_tiled main plugin
        .add_plugins(TiledMapPlugin::default())
        // Load bevy_ecs_tiled physics plugin: this is where we select
        // which physics backend to use (in this case, Avian)
        .add_plugins(TiledPhysicsPlugin::&lt;TiledPhysicsAvianBackend&gt;::default())
        // Load Avian main plugin
        .add_plugins(PhysicsPlugins::default().with_length_unit(100.0))
        // Add our systems and run the app!
        .add_systems(Startup, startup)
        .run();
}

// Just load the map as usual:
// colliders are spawned for every objects of your map
fn startup(mut commands: Commands, asset_server: Res&lt;AssetServer&gt;) {
    commands.spawn(Camera2d);
    commands.spawn(TiledMapHandle(asset_server.load(&quot;finite.tmx&quot;)));
}
</code></pre></pre>
<h2 id="objects-filtering"><a class="header" href="#objects-filtering">Objects filtering</a></h2>
<p>By default, we will spawn physics colliders for <strong>all</strong> objects encountered in the map, either regular objects or tiles colliders.
Eventhough it's probably the most common behaviour, you can also fine tune for which objects you want to spawn colliders for.</p>
<p>To do so, we provide the <a href="https://docs.rs/bevy_ecs_tiled/latest/bevy_ecs_tiled/physics/struct.TiledPhysicsSettings.html"><code>TiledPhysicsSettings</code></a> component.</p>
<p>This component, which should be added to the map or to the world entity, contains several filters.
Based upon its name, and its parent layer name, we can determine if a particular object should have collider or not.</p>
<pre><pre class="playground"><code class="language-rust no_run">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use bevy::prelude::*;
use bevy_ecs_tiled::prelude::*;

// Load the map with custom physics settings (and an Avian backend)
fn startup(mut commands: Commands, asset_server: Res&lt;AssetServer&gt;) {
    commands.spawn(Camera2d);
    commands.spawn((
        TiledMapHandle(asset_server.load(&quot;finite.tmx&quot;)),
        // With this configuration, we will restrict the spawn of colliders to:
        // - regular objects named 'hitbox' or 'collision'
        // - collision objects for tiles in a layer named 'collision'
        // We will not spawn colliders for objects not matching these conditions
        TiledPhysicsSettings::&lt;TiledPhysicsAvianBackend&gt; {
            objects_filter: ObjectNames::Names(vec![String::from(&quot;hitbox&quot;), String::from(&quot;collision&quot;)]),
            tiles_layer_filter: ObjectNames::Names(vec![String::from(&quot;collision&quot;)]),
            ..default()
        },
    ));
}
<span class="boring">}
</span></code></pre></pre>
<h2 id="colliders-aggregation"><a class="header" href="#colliders-aggregation">Colliders aggregation</a></h2>
<p>Tiled uses simple shapes, such as rectangles or ellipses, to define colliders :</p>
<ul>
<li>For tiles, you can use several of these simple shapes to define the whole tile collider</li>
<li>For regular objects (ie. objects inside an object layer), you can either use one of these simple shapes or colliders from an existing tile.</li>
</ul>
<p>In order to reduce the number of physics colliders, and improve overall performances, we will try to merge &quot;simple&quot; colliders together and spawn instead a single &quot;complex&quot; one.
However, keep in mind that if you use complex geometric forms (polygons) for your collisions, we won't be able to merge these colliders and you will still have multiples  colliders, potentially hurting performances.</p>
<p>For a given tiles layer we could have a single physics collider which consists of the aggregation of all tiles colliders it contains.
From a physics point of view we actually have a single collider per layer.</p>
<p>On the other hand, regular objects will always have their own physics collider.
Since they have a <code>Transform</code> and can be moved independently, it would not make sense to have a single colliders for several objects.
In case of &quot;tile objects&quot;, we will still try to merge colliders from the tile.</p>
<h2 id="custom-physics-backend"><a class="header" href="#custom-physics-backend">Custom physics backend</a></h2>
<p>For more advanced use cases, you can eventually define your own physics backend.
All you need to do is to create a struct that implements the <a href="https://docs.rs/bevy_ecs_tiled/latest/bevy_ecs_tiled/physics/trait.TiledPhysicsBackend.html"><code>TiledPhysicsBackend</code></a> trait, ie. provide an implementation for the <code>spawn_colliders</code> function and use that backend when adding the <code>TiledPhysicsPlugin&lt;T&gt;</code> to your app.</p>
<p>You can also extend one the provided backend if their implementation have something missing for you.
You can wrap your own implementation around and existing backend (see <a href="https://github.com/adrien-bon/bevy_ecs_tiled/blob/main/examples/physics_avian_controller.rs">this example for Avian</a> or <a href="https://github.com/adrien-bon/bevy_ecs_tiled/blob/main/examples/physics_rapier$_controller.rs">this one for Rapier</a>).</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../guides/spawn_reload.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../guides/properties.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../guides/spawn_reload.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../guides/properties.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
